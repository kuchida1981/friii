## Purpose
この仕様は、高品質なコードを維持するためのテスト基盤（モック生成、DBユニットテスト、結合テスト）およびテスト駆動開発（TDD）の具体的な要件と手法を定義する。

## Requirements

### Requirement: `moq` によるモック生成と利用の容易性
システムは `moq` を使用して、インターフェースに基づくモックを自動生成し、テストコードから容易に利用できる環境を整備しなければならない (SHALL)。

#### Scenario: `moq` によるモック生成
- **WHEN** 開発者が `go generate` を実行する
- **THEN** インターフェースに対する構造体ベースのモックファイルが生成され、各メソッドの挙動を個別に注入可能になる

### Requirement: `sqlmock` によるリポジトリ層のユニットテスト
システムは `sqlmock` を使用して、リポジトリ層の SQL 構築ロジックおよびエラーハンドリングの網羅的なユニットテストを可能にしなければならない (SHALL)。

#### Scenario: データベースエラーのシミュレーション
- **WHEN** データベースクエリ実行時にエラーを発生させるモックを設定してテストを実行する
- **THEN** アプリケーションが適切にエラーを検知し、ドメインエラーへの変換を行うことを検証できる

### Requirement: `Testcontainers` による不変性の結合テスト
システムは `Testcontainers for Go` を使用して、実際の PostgreSQL コンテナ上での結合テストを実行可能にし、データの不変性（UPDATE/DELETE 禁止）を検証しなければならない (SHALL)。

#### Scenario: `UPDATE` 操作の禁止検証
- **WHEN** 既存の仕訳レコードに対して `UPDATE` 操作を試みるテストを実行する
- **THEN** データベース制約またはアプリケーションロジックにより操作が拒否され、不変性が保たれていることを検証できる
