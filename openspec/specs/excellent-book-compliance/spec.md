## 追加される要件

### 要件: 不変な記録履歴
「優良な電子帳簿」としての整合性を保つため、システムは既存の仕訳レコードの物理的な削除や直接的な修正を許可してはならない。

#### シナリオ: レコードの削除試行
- **WHEN** ユーザーが仕訳レコードを削除しようとしたとき
- **THEN** システムはその操作を拒否し、レコードが不変であることを通知しなければならない

### 要件: 赤黒処理（訂正）
仕訳の誤りを訂正する場合、システムは誤ったレコードに対する「取消仕訳（赤）」と、新しい「正しい仕訳（黒）」を作成する赤黒処理をサポートしなければならない。

#### シナリオ: 既存仕訳の訂正
- **WHEN** ユーザーが仕訳の訂正を開始したとき
- **THEN** システムは元のレコードに関連付けられた取消レコードを自動的に生成し、新しい正しいレコードの作成を許可しなければならない

### 要件: 監査ログの自動記録
システムは、データの作成または無効化イベントごとに、タイムスタンプを含む監査ログを自動的に記録しなければならない。

#### シナリオ: 仕訳作成による監査ログのトリガー
- **WHEN** 新しい仕訳が正常に作成されたとき
- **THEN** システムは、その内容のフルペイロードとタイムスタンプを含む監査ログレコードを作成しなければならない

### 要件: 検索性と追跡可能性
システムは、取引日、金額範囲、勘定科目、および取引先による仕訳の検索とフィルタリングを許可しなければならない。

#### シナリオ: 日付範囲と金額による検索
- **WHEN** ユーザーが「2024-01-01」から「2024-03-31」の間で、金額が10,000円以上のエントリを検索したとき
- **THEN** システムは一致する全てのレコードを表示し、それらの発生源まで追跡可能にしなければならない
